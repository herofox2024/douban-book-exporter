# 豆瓣书评导出工具

一个Chrome浏览器扩展，用于自动爬取豆瓣已读书单并支持导出为CSV和HTML格式。

## 功能特性

- ✅ 自动爬取豆瓣已读书单
- ✅ 支持导出为CSV格式（适合数据分析）
- ✅ 支持导出为HTML格式（适合阅读分享）
- ✅ 自动获取用户信息和豆瓣Cookie
- ✅ 后台爬取，不影响当前页面浏览
- ✅ 实时爬取进度显示
- ✅ 支持多用户数据存储
- ✅ 遵循Chrome扩展Manifest V3标准

## 安装方法

1. 下载或克隆本项目到本地
2. 打开Chrome浏览器，进入扩展管理页面（`chrome://extensions/`）
3. 开启右上角的「开发者模式」
4. 点击「加载已解压的扩展程序」
5. 选择项目所在的`extension`文件夹
6. 扩展安装成功，会在Chrome工具栏出现扩展图标

## 使用说明

### 基本使用流程

1. 打开豆瓣网站（`https://www.douban.com`）并登录
2. 进入「已读书单」页面（`https://book.douban.com/people/用户名/collect`）
3. 点击Chrome工具栏中的扩展图标，打开扩展弹窗
4. 点击「开始爬取」按钮，等待爬取完成
5. 选择导出格式（CSV或HTML），点击「导出」按钮
6. 选择保存位置，完成导出

### 详细操作步骤

#### 1. 登录豆瓣账号

确保已登录豆瓣账号，扩展会自动获取登录状态和用户信息。

#### 2. 进入已读书单页面

在浏览器中打开你的豆瓣已读书单页面，URL格式为：
```
https://book.douban.com/people/你的用户名/collect
```

#### 3. 爬取数据

- 点击Chrome工具栏中的扩展图标
- 扩展会自动识别当前用户
- 点击「开始爬取」按钮
- 等待爬取进度达到100%

#### 4. 导出数据

- 选择导出格式：
  - **CSV格式**：适合导入Excel或进行数据分析
  - **HTML格式**：适合直接在浏览器中阅读或分享
- 点击「导出」按钮
- 在弹出的保存对话框中选择保存位置

## 技术栈

- **Chrome Extension Manifest V3**：扩展开发标准
- **JavaScript**：核心开发语言
- **Service Worker**：后台任务处理
- **Content Script**：页面内容交互
- **Chrome API**：
  - `cookies`：获取用户登录信息
  - `scripting`：执行页面脚本
  - `storage`：数据持久化存储
  - `downloads`：文件下载功能
  - `tabs`：标签页管理

## 项目结构

```
extension/
├── background.js      # 后台脚本，核心逻辑处理
├── content.js         # 内容脚本，页面交互
├── manifest.json      # 扩展配置文件
├── popup.html         # 扩展弹窗页面
├── popup.js           # 弹窗交互逻辑
└── README.md          # 项目说明文档
```

### 文件说明

- **background.js**：包含数据管理、豆瓣爬取和导出功能
- **content.js**：处理页面内容，辅助获取用户信息
- **manifest.json**：扩展的配置文件，定义权限和功能
- **popup.html**：扩展的弹窗UI
- **popup.js**：弹窗的交互逻辑

## 数据字段说明

导出的书籍数据包含以下字段：

| 字段名 | 说明 | 示例 |
|-------|------|------|
| 书名 | 书籍的名称 | 《小王子》 |
| 作者 | 书籍的作者 | 安东尼·德·圣-埃克苏佩里 |
| 出版日期 | 书籍的出版日期 | 2003-08-01 |
| 出版社 | 书籍的出版社 | 人民文学出版社 |
| 豆瓣链接 | 书籍的豆瓣链接 | https://book.douban.com/subject/1084336/ |
| 评分 | 书籍的豆瓣评分 | 9.0 |
| 书评内容 | 你的书评内容 | 这是一本经典的童话书... |
| 评分日期 | 你评分的日期 | 2023-05-15 |

## 常见问题

### Q: 爬取失败，提示「未找到豆瓣Cookie」

A: 请确保已登录豆瓣账号，并刷新已读书单页面后重试。

### Q: 导出的CSV文件显示乱码

A: 这是由于编码问题导致的，建议使用Excel或支持UTF-8编码的文本编辑器打开。

### Q: 爬取进度一直显示0%

A: 请检查网络连接，或刷新已读书单页面后重试。

### Q: 导出失败，提示「没有数据可导出」

A: 请先点击「开始爬取」按钮，爬取数据后再进行导出。

### Q: 扩展图标不显示

A: 请检查扩展是否已正确安装，或在Chrome扩展管理页面重新加载扩展。

## 注意事项

1. 请遵守豆瓣网站的使用规则，不要频繁爬取数据
2. 扩展会在后台自动爬取数据，爬取过程中请保持浏览器打开
3. 数据存储在浏览器本地，卸载扩展后数据会丢失
4. 建议定期导出数据备份

## 许可证

MIT License

## 更新日志

### v1.0.1 (2025-12-23)

- 修复了background.js中的代码错误
- 改进了爬取逻辑，增强了页面元素选择器的兼容性
- 重写了`crawlPageInBackgroundTab`方法，优化了后台爬取效率
- 增强了content.js的数据提取能力，支持多种页面布局
- 添加了详细的调试日志，便于问题排查
- 优化了数据提取逻辑，提高了数据准确性

### v1.0.0 (2025-12-22)

- 初始版本发布
- 支持豆瓣已读书单爬取
- 支持CSV和HTML格式导出
- 实现后台爬取功能
- 优化消息传递机制，解决消息端口关闭问题

## 贡献

欢迎提交Issue和Pull Request，共同改进这个工具。

## 联系方式

如有问题或建议，欢迎通过以下方式联系：

- GitHub Issues：[提交问题](https://github.com/herofox2024/douban-book-exporter/issues)
- 邮箱：42845734@qq.com

---

**使用提示**：请合理使用本工具，遵守豆瓣网站的使用规则，不要进行恶意爬取或滥用。